generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  email      String    @unique
  password   String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  role       Role      @default(USER)
  Hospital   Hospital? @relation(fields: [hospitalId], references: [id])
  hospitalId String?   @db.ObjectId
}

model Doctor {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  userId     String    @db.ObjectId
  name       String
  specialty  String?
  phone      String?
  email      String    @unique
  Hospital   Hospital? @relation(fields: [hospitalId], references: [id])
  hospitalId String?   @db.ObjectId
  patients   Patient[]
}

model Patient {
  id               String       @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  email            String
  age              Int
  gender           String
  weight           Float
  height           Float
  bloodType        String
  BMI              Float
  token            String
  hospitalId       String       @db.ObjectId
  assignedDoctorId String?      @db.ObjectId
  hospital         Hospital     @relation(fields: [hospitalId], references: [id])
  assignedDoctor   Doctor?      @relation(fields: [assignedDoctorId], references: [id])
  vitalSigns       VitalSign[]
  medications      Medication[]
  Threshold        Threshold[]
}

model Hospital {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  hospitalCode String    @unique
  name         String
  location     String?
  users        User[]
  doctors      Doctor[]
  patients     Patient[]
}

model VitalSign {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  patientId        String   @db.ObjectId
  timestamp        DateTime @default(now())
  heartRate        Int?     @default(0)
  bloodPressure    String?  @default("0/0")
  temperature      Float?   @default(0)
  respiratoryRate  Int?     @default(0)
  oxygenSaturation Int?     @default(0)
  patient          Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

model Medication {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  patientId String   @db.ObjectId
  name      String
  dosage    String
  frequency String
  startDate DateTime
  endDate   DateTime
  patient   Patient  @relation(fields: [patientId], references: [id])
}

model Threshold {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  doctorId  String  @db.ObjectId
  vitalType String
  minValue  Float
  maxValue  Float
  patientId String  @db.ObjectId
  patient   Patient @relation(fields: [patientId], references: [id])
}

enum Role {
  ADMIN
  USER
  DOCTOR
}
